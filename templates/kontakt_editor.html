<!DOCTYPE html>
{% extends "base.html" %}
{% block title %}{% if kontakt %}Kontakt bearbeiten{% else %}Neuer Kontakt{% endif %}{% endblock %}

{% block head_styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/kontakte.css') }}">
{% endblock %}

{% block content %}
<form method="post" action="{{ action_url }}">
    <div class="actions-header">
        <h1>{% if kontakt %}{{ kontakt_daten_for_template.get('Name') or kontakt_daten_for_template.get('Firmenname') or
            'Kontakt bearbeiten' }}{% else %}Neuen Kontakt erstellen{% endif %}</h1>
        <div class="button-group">
            <a href="{{ url_for('kontakte.auflisten') }}" class="button secondary">Abbrechen</a>
            <button type="submit" class="button">Speichern</button>
        </div>
    </div>

    <div class="modal-form-columns">
        {% for gruppe in vorlage_for_template.gruppen %}
        <div class="form-group-box">
            <h4 class="form-group-title">{{ gruppe.name }}</h4>
            {% for eigenschaft in gruppe.eigenschaften %}
            <div class="form-group">
                <label for="new-contact-{{ eigenschaft.name }}">{{ eigenschaft.name }}:</label>

                {% if eigenschaft.datentyp == 'Auswahl' %}
                <select id="new-contact-{{ eigenschaft.name }}" name="attribute_value_{{ eigenschaft.name }}"
                    class="input-field">
                    <option value="">-- Bitte wählen --</option>
                    {% for option in eigenschaft.optionen.split(',') %}
                    <option value="{{ option.strip() }}" {% if
                        kontakt_daten_for_template.get(eigenschaft.name)==option.strip() %}selected{% endif %}>
                        {{ option.strip() }}
                    </option>
                    {% endfor %}
                </select>
                {% elif eigenschaft.datentyp == 'Datum' %}
                <input id="new-contact-{{ eigenschaft.name }}" type="date" name="attribute_value_{{ eigenschaft.name }}"
                    value="{{ kontakt_daten_for_template.get(eigenschaft.name, '') }}" class="input-field">
                {% else %}
                <input id="new-contact-{{ eigenschaft.name }}" type="text" name="attribute_value_{{ eigenschaft.name }}"
                    value="{{ kontakt_daten_for_template.get(eigenschaft.name, '') }}" class="input-field">
                {% endif %}
                <input type="hidden" name="attribute_key_{{ eigenschaft.name }}" value="{{ eigenschaft.name }}">
            </div>
            {% endfor %}
        </div>
        {% endfor %}

        {% if kontakt and kontakt.import_raw_content %}
        <div class="form-group-box">
            <h4 class="form-group-title">Import-Rohdaten</h4>
            <div class="form-group">
                <label for="raw-import-content">Ursprünglicher Datei-Inhalt:</label>
                <textarea id="raw-import-content" class="input-field" rows="10"
                    readonly>{{ kontakt.import_raw_content }}</textarea>
            </div>
        </div>
        {% endif %}
    </div>
</form>

<script type="application/json" id="vorlage-for-json-data">{{ vorlage_for_json|safe }}</script>
<script type="application/json" id="kontakt-daten-for-json-data">{{ kontakt_daten_for_json|safe }}</script>

{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/kontakt_editor.js') }}"></script>
{% endblock %}