<!DOCTYPE html>
{% extends "base.html" %}
{% block title %}Vorlagen-Editor{% endblock %}

{% block head_styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/vorlage_editor.css') }}">
{% endblock %}

{% block content %}
<div id="vorlage-editor-app">
    <div v-if="activeModal === 'groupEdit'" class="modal-overlay" @click.self="closeModal">
        <div class="modal-content">
            <button @click="closeModal" class="modal-close-btn">&times;</button>
            <h3>Gruppe bearbeiten: <span style="color: var(--accent-color);" v-text="editedGroup.name"></span></h3>
            <div class="form-group"><label>Name der Gruppe</label><input type="text" v-model="editedGroup.name"></div>
            <hr>
            <h4>Eigenschaften</h4>
            <div class="modal-property-header"><span>Name</span><span>Datentyp</span><span>Optionen</span><span></span>
            </div>
            <div v-for="(eigenschaft, eigenschaftIndex) in editedGroup.eigenschaften" class="modal-property-row">
                <input type="text" v-model="eigenschaft.name" placeholder="Name der Eigenschaft">
                <select v-model="eigenschaft.datentyp">
                    <option>Text</option>
                    <option>Zahl</option>
                    <option>Datum</option>
                    <option>Boolean</option>
                    <option>Auswahl</option>
                    <option>Verknüpfung</option>
                </select>
                <div>
                    <select v-if="eigenschaft.datentyp === 'Auswahl'" v-model="eigenschaft.optionen">
                        <option value="">Standard-Auswahl wählen...</option>
                        <option v-for="opt in selectionOptions" :value="opt.values" v-text="opt.name"></option>
                    </select>
                    <select v-if="eigenschaft.datentyp === 'Verknüpfung'" v-model="eigenschaft.optionen">
                        <option value="">Vorlage auswählen...</option>
                        <option v-for="v in allVorlagen" :value="'vorlage_id:' + v.id">{{ v.name }}</option>
                    </select>
                </div>
                <button @click="removeEigenschaft(eigenschaftIndex)" class="icon-btn danger"
                    title="Eigenschaft löschen">❌</button>
            </div>
            <button @click="addEigenschaft" class="button secondary" style="margin-top: 1rem;">+ Eigenschaft
                hinzufügen</button>
            <div class="button-group">
                <button @click="closeModal" class="button secondary">Abbrechen</button>
                <button @click="saveGroup" class="button">Änderungen speichern</button>
            </div>
        </div>
    </div>

    <div v-if="activeModal === 'delete'" class="modal-overlay" @click.self="closeModal">
    </div>
</div>

<script type="application/json" id="vorlage-data">
    {{ vorlage_data|safe }}
</script>
<script type="application/json" id="action-url-data">
    {{ action_url|tojson|safe }}
</script>
<script type="application/json" id="all-vorlagen-data">
    {{ all_vorlagen|map(attribute='id')|zip(all_vorlagen|map(attribute='name'))|map('list')|list|tojson|safe }}
</script>
{% endblock %}

{% block scripts %}
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script src="{{ url_for('static', filename='js/vorlage_editor.js') }}"></script>
{% endblock %}