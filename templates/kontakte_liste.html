<!DOCTYPE html>
{% extends "base.html" %}
{% block title %}Kontaktübersicht{% endblock %}

{% block head_styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/kontakte.css') }}">
{% endblock %}

{% block content %}
<div id="kontakte-app">
    <div class="actions-header">
        <h1>Kontaktübersicht</h1>
        <div class="button-group">
            <button @click="openAddModal" class="button add">➕ Kontakt hinzufügen</button>
            <button @click="openImportModal" class="button secondary">↑ Aus MSG importieren</button>
        </div>
    </div>

    <div class="view-switcher">
        <label for="vorlagen-select" style="margin-right: 0.5rem; font-weight: 500;">Angezeigte Vorlage:</label>
        <select v-if="vorlagen.length > 0" v-model="activeVorlageId" id="vorlagen-select">
            <option v-for="vorlage in vorlagen" :value="vorlage.id" v-text="vorlage.name"></option>
        </select>
    </div>

    <div v-if="activeVorlage" class="card table-container">
        <table>
            <thead>
                <tr>
                    <th v-for="e in activeVorlage.eigenschaften" v-text="e.name"></th>
                    <th>Aktionen</th>
                </tr>
            </thead>
            <tbody>
                <tr v-for="kontakt in activeVorlage.kontakte">
                    <td v-for="e in activeVorlage.eigenschaften"><input type="text" :value="kontakt.daten[e.name] || ''"
                            @blur="updateField(kontakt, e.name, $event.target.value)" class="inline-edit-input"></td>
                    <td class="actions"><a :href="'/kontakte/editor?kontakt_id=' + kontakt.id" class="icon-btn edit"
                            title="Im Formular bearbeiten">✏️</a></td>
                </tr>
            </tbody>
        </table>
    </div>
    <div v-if="!activeVorlage" class="card">
        <p>Keine Vorlagen gefunden. <a href="{{ url_for('vorlagen_verwalten') }}">Erstelle zuerst eine Vorlage.</a></p>
    </div>

    <div v-if="isAddModalOpen" class="modal-overlay" @click.self="closeAddModal">
        ...
    </div>

    <div v-if="isImportModalOpen" class="modal-overlay" @click.self="closeImportModal">
        ...
    </div>
</div>

<script type="application/json" id="vorlagen-for-json-data">
    {{ vorlagen_for_json|safe }}
</script>
{% endblock %}

{% block scripts %}
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script src="{{ url_for('static', filename='js/kontakte_liste.js') }}"></script>
{% endblock %}