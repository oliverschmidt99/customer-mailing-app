{% macro render_kontakt_form(kontakt_typ, kontakt, action_url, mitarbeiter_liste=none, status_optionen=none,
status_emojis=none, akademische_titel=none, pastel_colors=none) %}
<form action="{{ action_url }}" method="post">

    <div class="form-grid-2">
        <fieldset>
            <legend>Personendaten</legend>
            <div class="form-grid-2">
                <div class="form-group">
                    <label for="anrede">Anrede</label>
                    <select id="anrede" name="anrede" required>
                        <option value="Herr" {% if kontakt.anrede=='Herr' %}selected{% endif %}>Herr</option>
                        <option value="Frau" {% if kontakt.anrede=='Frau' %}selected{% endif %}>Frau</option>
                        <option value="Divers" {% if kontakt.anrede=='Divers' %}selected{% endif %}>Divers</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="vorname">Vorname</label>
                    <input type="text" id="vorname" name="vorname" value="{{ kontakt.vorname or '' }}">
                </div>
            </div>
            <div class="form-group">
                <label for="nachname">Nachname</label>
                <input type="text" id="nachname" name="nachname" value="{{ kontakt.nachname or '' }}" required>
            </div>
            <div class="form-group">
                <label for="geburtsdatum">Geburtsdatum</label>
                <input type="date" id="geburtsdatum" name="geburtsdatum" value="{{ kontakt.geburtsdatum or '' }}">
            </div>
        </fieldset>

        <fieldset>
            <legend>Firma & Kontakt</legend>
            <div class="form-grid-2">
                <div class="form-group">
                    <label for="firma">Firma</label>
                    <input type="text" id="firma" name="firma" value="{{ kontakt.firma or '' }}">
                </div>
                <div class="form-group">
                    <label for="position">Position</label>
                    <input type="text" id="position" name="position" value="{{ kontakt.position or '' }}">
                </div>
            </div>
            <div class="form-grid-2">
                <div class="form-group">
                    <label for="email">E-Mail</label>
                    <input type="email" id="email" name="email" value="{{ kontakt.email or '' }}">
                </div>
                <div class="form-group">
                    <label for="telefon">Telefon</label>
                    <input type="text" id="telefon" name="telefon" value="{{ kontakt.telefon or '' }}">
                </div>
            </div>
        </fieldset>
    </div>

    <fieldset>
        <legend>Akademische Titel</legend>
        <div class="title-selector-container form-group" data-selected-titles="{{ kontakt.titel or '' }}">
            <div class="selected-titles"></div>
            <input type="text" class="title-search" placeholder="Titel suchen...">
            <div class="title-options">
                {% for titel in akademische_titel %}
                <label><input type="checkbox" name="titel" value="{{ titel }}"> {{ titel }}</label>
                {% endfor %}
            </div>
        </div>
    </fieldset>

    <fieldset>
        <legend>Adresse</legend>
        <div class="form-grid-3">
            <div class="form-group" style="grid-column: 1 / 3;">
                <label for="strasse">Straße</label>
                <input type="text" id="strasse" name="strasse" value="{{ kontakt.strasse or '' }}">
            </div>
            <div class="form-group">
                <label for="hausnummer">Hausnummer</label>
                <input type="text" id="hausnummer" name="hausnummer" value="{{ kontakt.hausnummer or '' }}">
            </div>
        </div>
        <div class="form-grid-3">
            <div class="form-group">
                <label for="plz">PLZ</label>
                <input type="text" id="plz" name="plz" value="{{ kontakt.plz or '' }}">
            </div>
            <div class="form-group" style="grid-column: 2 / 4;">
                <label for="ort">Ort</label>
                <input type="text" id="ort" name="ort" value="{{ kontakt.ort or '' }}">
            </div>
            <div class="form-group">
                <label for="land">Land</label>
                <input type="text" id="land" name="land" value="{{ kontakt.land or 'Deutschland' }}">
            </div>
        </div>
    </fieldset>

    <fieldset>
        <legend>Tags</legend>
        <div class="tag-selector-container form-group" data-selected-tags="{{ kontakt.tag or '' }}">
            <div class="selected-tags"></div>
            <button type="button" class="add-tags-btn">+ Tags auswählen</button>
        </div>
    </fieldset>

    {% if kontakt_typ == 'Kunde' %}
    <fieldset>
        <legend>Kundeninformationen</legend>
        <div class="form-group">
            <label for="mitarbeiter_id">Zugeordneter Mitarbeiter</label>
            <select id="mitarbeiter_id" name="mitarbeiter_id">
                <option value="">Kein Mitarbeiter</option>
                {% for m in mitarbeiter_liste %}
                <option value="{{ m.id }}" {% if m.id==kontakt.mitarbeiter_id %}selected{% endif %}>{{ m.vorname }} {{
                    m.nachname }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="form-group">
            <label for="bevorzugter_kontaktweg">Bevorzugter Kommunikationskanal</label>
            <input type="text" id="bevorzugter_kontaktweg" name="bevorzugter_kontaktweg"
                value="{{ kontakt.bevorzugter_kontaktweg or '' }}">
        </div>
        <div class="form-group">
            <label>Status</label>
            <div class="status-palette">
                {% for status in status_optionen %}
                <label class="status-label">
                    <input type="radio" name="status" value="{{ status }}" {% if status==kontakt.status or (not
                        kontakt.id and loop.first) %}checked{% endif %}>
                    <span class="status-swatch">{{ status_emojis[status] }} {{ status }}</span>
                </label>
                {% endfor %}
            </div>
        </div>
    </fieldset>
    {% endif %}

    {% if kontakt_typ == 'Mitarbeiter' %}
    <fieldset>
        <legend>Darstellung</legend>
        <div class="form-group">
            <label>Farbe</label>
            <div class="color-palette">
                {% for color in pastel_colors %}
                <label class="color-swatch-label">
                    <input type="radio" name="farbe" value="{{ color }}" {% if color==kontakt.farbe or (not
                        kontakt.farbe and loop.first) %}checked{% endif %}>
                    <span class="color-swatch" style="background-color: {{ color }};"></span>
                </label>
                {% endfor %}
            </div>
        </div>
    </fieldset>
    {% endif %}

    <fieldset>
        <legend>Notizen</legend>
        <div class="form-group">
            <textarea id="notizen" name="notizen" rows="3">{{ kontakt.notizen or '' }}</textarea>
        </div>
    </fieldset>

    <div class="button-group" style="margin-top: 1rem;">
        <button type="submit">Speichern</button>
        <button type="button" class="button secondary modal-cancel-btn">Abbrechen</button>
    </div>
</form>
{% endmacro %}