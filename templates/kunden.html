<!DOCTYPE html>
{% extends 'base.html' %}
{% block content %}
<h1>Kundenverwaltung</h1>
<div class="card">
    <h2>Aktionen</h2>
    <a href="{{ url_for('kunde_neu_form') }}" class="button-primary">Neuen Kunden anlegen</a>
</div>
<div class="card">
    <h2>Kunden aus .msg-Dateien importieren</h2>
    <form action="{{ url_for('upload_msg') }}" method="post" enctype="multipart/form-data">
        <fieldset>
            <legend>1. Mitarbeiter zuordnen</legend>
            <label for="mitarbeiter_id">Für welchen Mitarbeiter importieren?</label>
            <select name="mitarbeiter_id" id="mitarbeiter_id" required>
                <option value="" disabled selected>-- Bitte wählen --</option>
                {% for m in mitarbeiter %}
                <option value="{{ m.id }}">{{ m.vorname }} {{ m.nachname }}</option>
                {% endfor %}
            </select>
        </fieldset>
        <fieldset>
            <legend>2. Standard-Postart für diesen Import festlegen</legend>
            <div class="checkbox-group">
                <input type="checkbox" id="postkarte" name="postkarte">
                <label for="postkarte">Physisch: Postkarte</label>
            </div>
            <div class="checkbox-group">
                <input type="checkbox" id="kalender" name="kalender">
                <label for="kalender">Physisch: Kalender</label>
            </div>
            <div class="checkbox-group">
                <input type="checkbox" id="email_versand" name="email_versand">
                <label for="email_versand">Digital: E-Mail</label>
            </div>
            <div class="checkbox-group">
                <input type="checkbox" id="speziell" name="speziell">
                <label for="speziell">Spezielle Post</label>
            </div>
        </fieldset>
        <fieldset>
            <legend>3. Dateien auswählen</legend>
            <label for="msg_files">.msg-Dateien auswählen:</label>
            <input type="file" name="msg_files" multiple required>
        </fieldset>
        <button type="submit">Hochladen & Importieren</button>
    </form>
</div>
<div class="card">
    <h2>Bestehende Kunden</h2>
    <table>
        <thead>
            <tr>
                <th>Status</th>
                <th>Nachname</th>
                <th>Vorname</th>
                <th>Zugeordnet zu</th>
                <th>Aktionen</th>
            </tr>
        </thead>
        <tbody>
            {% for k in kunden %}
            <tr>
                <td>{{ status_emojis.get(k.status, '') }} {{ k.status }}</td>
                <td>{{ k.nachname }}</td>
                <td>{{ k.vorname }}</td>
                <td style="background-color: {{ k.mitarbeiter.farbe if k.mitarbeiter else 'transparent' }};">
                    {% if k.mitarbeiter %}{{ k.mitarbeiter.nachname }}{% else %}---{% endif %}
                </td>
                <td class="actions">
                    <a href="{{ url_for('weihnachtspost_verwalten', kunde_id=k.id) }}" class="button-secondary">Post</a>
                    <a href="{{ url_for('kunde_bearbeiten', id=k.id) }}" class="button-secondary">Bearbeiten</a>
                    <form action="{{ url_for('kunde_loeschen', id=k.id) }}" method="post"
                        onsubmit="return confirm('Kunde wirklich löschen?');">
                        <button type="submit" class="danger">Löschen</button>
                    </form>
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="5">Noch keine Kunden angelegt.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}