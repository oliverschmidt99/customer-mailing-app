<!DOCTYPE html>
{% extends 'base.html' %}
{% block title %}Kunden端bersicht{% endblock %}

{% block content %}
<h1>Kunden端bersicht & Filter</h1>
<div class="card config-section active">
    <form method="get" action="{{ url_for('uebersicht') }}">
        <div class="filter-grid">
            <div class="form-group">
                <label for="mitarbeiter_id">Mitarbeiter</label>
                <select name="mitarbeiter_id" id="mitarbeiter_id" onchange="this.form.submit()">
                    <option value="">Alle Mitarbeiter</option>
                    {% for m in mitarbeiter_liste %}
                    <option value="{{ m.id }}" {% if aktiver_mitarbeiter==m.id|string %}selected{% endif %}>
                        {{ m.vorname }} {{ m.nachname }}
                    </option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-group">
                <label for="benachrichtigungsart">Benachrichtigungsart (f端r {{ aktives_jahr }})</label>
                <select name="benachrichtigungsart" id="benachrichtigungsart" onchange="this.form.submit()">
                    <option value="">Alle Arten</option>
                    <option value="brief" {% if aktive_benachrichtigungsart=='brief' %}selected{% endif %}>Brief
                    </option>
                    <option value="kalender" {% if aktive_benachrichtigungsart=='kalender' %}selected{% endif %}>
                        Kalender</option>
                    <option value="email_versand" {% if aktive_benachrichtigungsart=='email_versand' %}selected{% endif
                        %}>E-Mail
                    </option>
                    <option value="speziell" {% if aktive_benachrichtigungsart=='speziell' %}selected{% endif %}>
                        Spezielle Benachrichtigung
                    </option>
                </select>
            </div>
            <div class="form-group">
                <label for="status">Status</label>
                <select name="status" id="status" onchange="this.form.submit()">
                    <option value="">Alle Status</option>
                    {% for s in status_optionen %}
                    <option value="{{ s }}" {% if aktiver_status==s %}selected{% endif %}>{{ s }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>
    </form>
</div>

<div class="card config-section active">
    <h2>Spalten ein-/ausblenden</h2>
    <div id="column-toggler" class="column-toggler"></div>
</div>

<div class="card config-section active">
    <h2>Gefilterte Kunden ({{ kunden|length }})</h2>
    <div class="table-container">
        <table id="overview-table">
            <thead>
                <tr>
                </tr>
            </thead>
            <tbody>
                {% for k in kunden %}
                <tr>
                    <td class="col-id">{{ k.id }}</td>
                    <td class="col-status">{{ status_emojis.get(k.status, '') }} {{ k.status }}</td>
                    <td class="col-mitarbeiter"
                        style="background-color: {{ k.mitarbeiter.farbe if k.mitarbeiter else 'transparent' }};">
                        {% if k.mitarbeiter %}{{ k.mitarbeiter.nachname }}{% else %}---{% endif %}
                    </td>
                    <td class="col-anrede">{{ k.anrede or '' }}</td>
                    <td class="col-titel">{{ k.titel or '' }}</td>
                    <td class="col-vorname">{{ k.vorname or '' }}</td>
                    <td class="col-nachname">{{ k.nachname or '' }}</td>
                    <td class="col-firma1">{{ k.firma1 or '' }}</td>
                    <td class="col-firma2">{{ k.firma2 or '' }}</td>
                    <td class="col-funktion">{{ k.funktion or '' }}</td>
                    <td class="col-abteilung">{{ k.abteilung or '' }}</td>
                    <td class="col-strasse">{{ k.strasse or '' }}</td>
                    <td class="col-plz">{{ k.postleitzahl or '' }}</td>
                    <td class="col-ort">{{ k.ort or '' }}</td>
                    <td class="col-land">{{ k.land or '' }}</td>
                    <td class="col-anschriftswahl">{{ k.anschriftswahl or '' }}</td>
                    <td class="col-email">{{ k.email or '' }}</td>
                    <td class="col-tel-beruflich">{{ k.telefon_beruflich or '' }}</td>
                    <td class="col-durchwahl">{{ k.durchwahl_buero or '' }}</td>
                    <td class="col-mobil">{{ k.mobil_telefon or '' }}</td>
                    <td class="col-fax">{{ k.faxnummer or '' }}</td>
                    <td class="col-tel-privat">{{ k.telefon_privat or '' }}</td>
                    <td class="col-anmerkungen" title="{{ k.anmerkungen or '' }}">{{ (k.anmerkungen[:30] + '...') if
                        k.anmerkungen and k.anmerkungen|length > 30 else (k.anmerkungen or '') }}</td>
                    <td class="actions col-aktionen">
                        <a href="{{ url_for('kunde_bearbeiten', id=k.id) }}" class="button secondary">Bearbeiten</a>
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td id="no-customer-cell" colspan="24">Keine Kunden f端r die aktuellen Filter gefunden.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/uebersicht.js') }}"></script>
{% endblock %}